## Components



|Category           |  #| What                                               |              | Supplier        |
|:------------------|--:|:---------------------------------------------------|:-------------|:----------------|
|3D Print           | 1 | ABS 3D printer                                     | <img width="100" src="https://store.zortrax.com/image/cache/catalog/new_carousel/M200_FI_U_02_C50_04-489x489.png"/> | [Zortrax M200](https://store.zortrax.com/M200) |
|                   |   | Petroleum, Acetone                                 | <img width="100" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Acetone-structural.png/255px-Acetone-structural.png"/> | Local Dealer    | 																																			        |
|Electronics        | 1 | ODroid C2, 1.5 GHz Quadcore board                  | <img width="100" src="http://www.hardkernel.com/main/_Files/prdt/2016/201602/ODROID-C2.png"/>                       |  [ODroid C2](http://www.hardkernel.com/main/products/prdt_info.php?g_code=G145457216438) |
|                   | 1 | Teensy 3.5, Arm M4 board                           | <img width="100" src="https://www.pjrc.com/store/teensy35.jpg"/>                                                    | [Teensy 3.5](https://www.pjrc.com/store/teensy35.html ) |
|                   | 5 | Distance Sensors VL6180X						     | <img width="100" src="https://cdn-shop.adafruit.com/970x728/3316-00.jpg"/>                                          | [Adafruit VL6180X](https://www.adafruit.com/product/3316  ) |
|                   | 1 | Step down voltage converter, 5V, 5A                | <img width="100" src="https://a.pololu-files.com/picture/0J5851.600x480.jpg"/>                                      | [Pololu D24V50F5](https://www.pololu.com/product/2851 )  |
|                   | 1 | Step down voltage converter, 5A, adjustable        | <img width="100" src="http://www.xcluma.com/image/cache/data/products/XL4015-DC-DC-Step-Down-Adjustable-Power-Supply-650x489.jpg"/>| [XL4016](http://www.xcluma.com/xl4015-5a-dc-dc-step-down-adjustable-power-supply-buck-module)  |
|                   | 1 | IMU BNO055                                         | <img width="100" src="https://cdn-shop.adafruit.com/970x728/2472-00.jpg"/>                                           | [Adafruit  BNO055](https://www.adafruit.com/product/2472 )  |
|Servos             |10 | Hip and Knee Servo, 1.2 Nm 						 | <img width="100" src="http://www.francerobotique.com/223-thickbox_default/herkulex-drs-0101.jpg"/>                   | [HerkuleX DRS-0101](http://www.francerobotique.com/servomoteurs-intelligents/175-herkulex-drs-0101.html )  |
|                   | 5 | Foot Servo 2.4 Nm         					     | <img width="100" src="http://www.francerobotique.com/224-thickbox_default/herkulex-drs-0201.jpg"/>                   | [Herkulex DRS-0201](http://www.francerobotique.com/servomoteurs-intelligents/176-herkulex-drs-0201.html) |
|                   | 5 | Thigh Servo, 5.2Nm      							 | <img width="100" src="http://www.francerobotique.com/225-thickbox_default/herkulex-drs-0401.jpg"/>                   | [Herkulex DRS-0401](http://www.francerobotique.com/servomoteurs-intelligents/177-herkulex-drs-0401.html)  |
|                   | 10 | Additional Servo Cables 300mm  					 | <img width="100" src="http://www.francerobotique.com/1089-thickbox_default/4-c%C3%A2bles-4p-300mm.jpg"/>             | [Cable 300mm](http://www.francerobotique.com/connectiques-c%C3%A2bles/236-4-c%C3%A2bles-4p-300mm.html) |
|                   | 10 | Additional Servo Cables 200mm			   	     | <img width="100" src="http://www.francerobotique.com/1088-thickbox_default/8-c%C3%A2bles-4p-200mm.jpg"/>             | [Cable 200mm](http://www.francerobotique.com/connectiques-c%C3%A2bles/235-8-c%C3%A2bles-4p-200mm.html) |
|Mechanical Stuff   |30 | distance sleeve M2 5mm							 | <img width="100" src="https://static4.tme.eu/products_pics/6/7/a/67a830716aad8b9637849d11259244ed/46553.jpg"/>       | [M2 5mm](https://www.tme.eu/de/details/tff-m2x5_dr111/distanzelemente-aus-metall/dremec/111x05/) |
|                   |20 | deep groove ball bearing  11x7x3 mm				 | <img width="100" src="https://www.kugellager-express.de/media/image/product/5758/md/miniatur-kugellager-mr117-zz-7x11x3-mm.jpg"/> | [11x7x3](https://www.kugellager-express.de/miniatur-kugellager-mr117-zz-7x11x3-mm) |
|                   |5 | deep groove ball bearing 35x44x5 mm				 | <img width="100" src="https://www.kugellager-express.de/media/image/product/3725/md/rillenkugellager-6707-2rs-61707-2rs-35x44x5-mm.jpg"/> | [35x44x5](https://www.kugellager-express.de/rillenkugellager-6707-2rs-61707-2rs-35x44x5-mm) |
|                   |some| allen screws M2 of length 6,8,10   	             |  <img width="100" src="http://i.ebayimg.com/images/g/5LEAAOSwFV9Xx-dh/s-l1600.jpg"/>                                   | [allen screws](http://www.ebay.de/itm/272073684666?var=571251898594) |
|                   |40| allen screws M2.6 x 4mm (for DRS-0401 servo, they should be included. They are hard to get, 2.6x5mm works too) | <img width="100" src="https://www.graupner.de/media/image/fe/29/36/H32205_Schraube_01.jpg"/>          | [allen screws](https://www.graupner.de/Zylinderkopf-Schraube-M2-6x5-Innensechskant-10-Stueck/H32205/) |
| Batteries         |4 | LiPO Battery, size 18650                            | <img width="100" src="https://www.akkuteile.de/item/images/100697/1900x1900/LG-INR18650MJ1-3500mAh-3-6-3-7V--10A.jpg"/> | [3500mAh,3C,10A ](https://www.akkuteile.de/lg-inr18650mj1-3500mah-3-75v-lithium-akku/a-100697/) |
|                   |4 | battery clips                                       |<img width="100" src="https://images-na.ssl-images-amazon.com/images/I/61BnucgzWPL._SL1100_.jpg"/>                    | [clips](https://www.amazon.de/gp/product/B00GN3PN46/ref=oh_aui_detailpage_o00_s00?ie=UTF8&psc=1) |

## Source code

|Category              |  Description                                                        | Source     |
|:---------------------|:--------------------------------------------------------------------|:-----------|
|CAD Model             | Inventor: Body and leg design                                       | [Github Pentapod CAD](https://github.com/jochenalt/Pentapod-Design/tree/master/cad/Inventor) |
|                      | 3D printable files of body and legs parts                           | [Github Pentapod STL](https://github.com/jochenalt/Pentapod-Design/tree/master/cad/stl) |
|                      | Simplified STL files to be used in openGL                           | [Github Pentapod Simplified STL](https://github.com/jochenalt/Pentapod-Design/tree/master/cad/simplified) |
|Electronics           | KiCad Schematics and PCB of Cortex and Power Supply                 | [Github Cortex Schematics](https://github.com/jochenalt/Pentapod-Design/tree/master/schematics/CortexBoard%2040x) |
|                      | KiCad Schematics and PCB of Sensor Board                            | [Github Sensor Schematics](https://github.com/jochenalt/Pentapod-Design/tree/master/schematics/SensorAdapter) |
|Source Code           | Sensor: Arduino C++ code running on ATMega8, IDE Atmel Studio       | [Github SensorAdapter](https://github.com/jochenalt/Pentapod-Code/tree/master/Sensor) |
|                      | Cortex: Arduino C++ code running on Teensy 3.5, IDE Eclipse Sloeber | [Github Cortex](https://github.com/jochenalt/Pentapod-Code/tree/master/Cortex) |
|                      | Brain: ROS/Ubuntu C++ code running on Odroid C2, IDE Eclipse        | [Github ROS Nodes](https://github.com/jochenalt/Pentapod-Code/tree/master/ros/src) |


## Herkulex IDs

HerkuleX Servos are addressed with the so-called HerkuleX identifier. Each command has to be accompagnied by this ID. It is setup upfront with the [HerkuleX Manager](http://www.dongburobot.com/jsp/board/boardDown.jsp?bseq=6783), otherwise all servos would have the same identifier coming from the factory settings. The convention used is shown in this table. The strange numbering scheme is due to the fact that I replace the thigh servos in the middle of the project and did not want to re-programme all 20 servos.

|Limb              |  Servo type        | Formula          |  Leg 1 | Leg 2 | Leg 3 | leg 4 | leg 5 |
|:-----------------|:-------------------|:-----------------|:-------|:------|:------|:------|:------|
| Hip              | DRS 0101           | legNo*10 -10 + 1 | 01     | 11    | 12    | 13    | 14    |
| Thigh            | DRS 0401           | legNo + 100      | 100    | 101   | 102   | 103   | 104   |
| Knee             | DRS 0101           | legNo*10 - 10 + 4| 03     | 13    | 23    | 33    | 43    |
| Foot             | DRS 0201           | legNo*10 - 10 + 2| 02     | 12    | 22    | 32    | 42    |

## Herkulex servo control

Dongu provides a c++ library that allows to control Herkulex servos. Software-enginering-wise, this implementation is the worst I have ever seen from a company that provides high-quality robotics accessories. Anyhow. If you check out my modifications, do not judge me, I kept the style of the library.

The most important modification I did to this library was to send commands to it without waiting for a result in order to speed up the communication. The servos are controlled by 5 serial lines, and the controlller frequency is 35Hz. Within one loop, move commands are send to the limbs of all legs  simultaneously, i.e. the first round takes care of all hips, then of all thighs, etc. (check [Controller::sendCommandToServos](https://github.com/jochenalt/Pentapod-Code/tree/master/Cortex/Controller.cpp).
The status of the servos is fetched in a separate loop of 1.6Hz, i.e. per loop one servo is asked for its status data.

In addition I enhanced this library to provide access to the servo's PID controller and to return voltage and temperature. Thing is, that the default PID controller has a very weak P factor, which make the servo kind of flexible, but leads to a high latency, especially when the IMU recognizes a change that needs to be processes quickly. So, I increased the servos P and I factor a lot which made the servos stiffer (check [HerkulexServoDriver::setup](https://github.com/jochenalt/Pentapod-Code/tree/master/Cortex/HerkulexServoDrive.cpp)


## Tools
|Category              |  Description                                                        | Source     |
|:---------------------|:--------------------------------------------------------------------|:-----------|
|Herkulex Manager      | Tool to setup a HerkuleX servo.                                     |  [HerkuleX Manager](http://www.dongburobot.com/jsp/board/boardDown.jsp?bseq=6783) |
|IDE for Teensy        | Eclipse derivate to develop and deploy in C++ on Teensy             |  [Eclipse Sloeber](http://eclipse.baeyens.it) |
|ROS Kinetic           | ROS Version I used. Although the newer lunar is out for a while, many tools required are not yet available on Lunar that I went with the elder version |  [ROS Kinetic](http://wiki.ros.org/kinetic) |

